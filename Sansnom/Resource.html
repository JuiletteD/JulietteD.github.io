<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">

    <title>Dynamique</title>
    <link rel="stylesheet" type="text/css" href="../style.css">

  </head>

  <body>
    <header>
      <h1>Site sans nom</h1>
    </header>

    <nav>
      <ul>
        <li><a href="../CV/page1.html">Qui suis-je</a></li>
        <li><a href="./page2.html">Page de video</a></li>
        <li><a href="./tp_js_2_exo1.html">Page de carre</a></li>
        <li><a href="../index.html">Accueil</a></li>
      </ul>

     </nav>

     <main>

      <aside>   
      </aside>
      <article>
        <h2>Aller chercher la resource</h2>

<h3>Fetch / async</h3>
 

 <button onclick="fetchJSON()">Load circle</button>
 <canvas id="canvas" width="600" height="600"></canvas>

<h3>Fetch</h3>
   <ul class="signatures"></ul>

<h3>XMLHttp</h3>
   <ul class="signatures2"></ul>


      </article>
    </main>

    <footer>
      <p>Â©Copyright ... </p>
    </footer>
<SCRIPT LANGUAGE="Javascript"> 
var i = 0;
var interv = setInterval(decompt, 100);

function decompt(){
i=i+1;
}
function draw(x,y){
let canvas = document.getElementById("canvas");
let context = canvas.getContext("2d");
let centerX = canvas.width / 2;
let centerY = canvas.height / 2;
let radius = 70;
context.arc(x%600, y%600, radius, 0, 2 * Math.PI, false);/* close the path */
/*context.closePath(); fill it with grey color */
/*context.fillStyle = "#ddd";*/
/*context.fill(); give a border to the circle */
context.strokeStyle = "rgba(200, 208, 218, 0.66)";
context.stroke();
}

async function fetchJSON() {
  const response = await fetch("https://stwom.herokuapp.com/"+i);
  let rep = JSON.parse(await response.text()); 
  console.log(rep.x);
  draw(rep.x,rep.y);
}

fetch("https://cat-fact.herokuapp.com/facts") .then(response => response.text())
  .then(data => {
     let rep =JSON.parse(data);
     const signatures = document.querySelector('.signatures');
     for(i=0;i<rep.length;i++){
       const li = document.createElement('li');
       li.innerText = rep[i].text;
       signatures.appendChild(li);
     }
  });


function reqListener () {
  let rep =JSON.parse(this.responseText);
  const signatures = document.querySelector('.signatures2');
     for(i=0;i<rep.length;i++){
       const li = document.createElement('li');
       li.innerText = rep[i].text;
       signatures.appendChild(li);
     }  for(i=0;i<rep.length;i++){
    //console.log(rep[i].text);
  }
}

var oReq = new XMLHttpRequest();
oReq.onload = reqListener;
oReq.open("get", "https://cat-fact.herokuapp.com/facts", true);
oReq.send();
              

</script>

</body>
</html>
